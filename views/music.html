{% extends "base.html" %}
    {% block title %} My Music Room {% endblock %}
    {% block content %}
    <div class="main-content-container">
        
       <div class="upload-section">
           <h2 class="section-title">Unggah Musik Atau Video</h2>
           <form action="{{ url_for('upload_music') }}" method="post" class="upload-form">
               <div class="form-group">
                   <label for="file-upload" class="upload-label">Pilih File (Musik atau Video)</label>
                   <input type="file" name="file" id="file-upload" required>
               </div>
               <div class="form-group">
                   <label for="title">Judul:</label>
                   <input type="text" name="title" id="title" placeholder="Judul Lagu atau Video" required>
               </div>
               <div class="form-group">
                   <label for="artist">Artis:</label>
                   <input type="text" name="artist" id="artist" placeholder="Nama Artis" required>
               </div>
               <div class="form-group">
                   <label for="album_art_file">Pilih Sampul Album (Opsional):</label>
                   <input type="file" name="album_art_file" id="album_art_file" accept="image/*">
               </div>
               <button type="submit" class="btn btn-primary">Unggah</button>
           </form>
       </div>
<div id="upload-overlay" class="upload-overlay hidden">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div id="upload-status-text" class="mt-2">File sedang diunggah...</div>
</div>
        
    </div>

    <div class="music-room-container">
        <div class="header-section">
            <h2 class="section-title">My Music Room</h2>
            <p class="section-description">No Worry, Bee Happy</p>
        </div>
    
        <div class="mode-switcher-container">
            <button id="toggleModeBtn" class="btn btn-secondary mode-toggle-button" data-mode="video"> 
                <svg class="video-icon" width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M23 7H1V17H23V7ZM21 9V15H3V9H21ZM13 11V13H11V11H13ZM18 11V13H16V11H18ZM8 11V13H6V11H8Z" fill="currentColor"/>
                </svg>
                <svg class="music-icon hidden" width="24px" height="24px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM11 16H9V8H11V16ZM15 16H13V8H15V16Z" fill="currentColor"/>
                </svg>
                <span class="button-text">Switch to Music Mode</span>
            </button>
        </div>

        <div id="content-display-container">
            
            <h2 class="list-title">Video Pendek</h2>
            <div class="video-pendek-list">
                {% for song in music_library[:3] %}
                <div class="media-card-horizontal">
                    <div class="thumbnail-container">
                        <video class="music-player video-player {% if not song.video_url %}no-media{% endif %}" controls preload="metadata" src="{{ song.video_url }}" {% if not song.video_url %}disabled{% endif %}>
                            <source src="{{ song.video_url }}" type="video/mp4">
                            Browser Anda tidak mendukung tag video.
                        </video>
                    </div>
                    <div class="media-details">
                        <h3 class="song-title">{{ song.title }}</h3>
                        <p class="artist-name">{{ song.artist }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>

            <hr>
            
            <h2 class="list-title">Video</h2>
            <div class="video-list">
                {% for song in music_library[3:] %}
                <div class="media-card-vertical">
                    <div class="media-thumbnail-vertical">
                        <video class="music-player video-player {% if not song.video_url %}no-media{% endif %}" controls preload="metadata" src="{{ song.video_url }}" {% if not song.video_url %}disabled{% endif %}>
                            <source src="{{ song.video_url }}" type="video/mp4">
                            Browser Anda tidak mendukung tag video.
                        </video>
                    </div>
                    <div class="media-details-vertical">
                        <h3 class="song-title-vertical">{{ song.title }}</h3>
                        <p class="artist-name-vertical">{{ song.artist }}</p>
                        <small class="upload-date">Diunggah: {{ song.date_uploaded.strftime('%Y-%m-%d %H:%M') }}</small>
                    </div>
                    <div class="media-actions">
                        {% if current_user == song.user or current_user.is_admin %}
                        <form action="{{ url_for('delete_music', music_id=song.id) }}" method="POST" style="display:inline-block;">
                            <button type="submit" class="btn btn-danger delete-button" onclick="return confirm('Apakah Anda yakin ingin menghapus media ini?')">Hapus</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="music-list hidden">
                <h2 class="list-title">My Music</h2>
                <p>Isi daftar musik akan muncul di sini.</p>
            </div>
            
            {% if not music_library %}
            <div class="no-media-message">
                <p>Anda belum mengunggah media apapun.</p>
            </div>
            {% endif %}
            
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/rosemary.js') }}"></script>
{% endblock %}
