{% extends "base.html" %}

{% block title %}Profil: {{ user.username }}{% endblock %}

{% block content %}
    <div class="container">
        <div class="card profile-card">
            <div class="profile-header">
                <img class="profile-image" src="{{ user.profile_image_url }}" alt="Foto Profil">
                <h1 class="profile-name">{{ user.username }}</h1>
                <p class="profile-join-date">Bergabung sejak: {{ user.date_joined.strftime('%d-%m-%Y') if user.date_joined else 'Tidak diketahui' }}</p>
                <p class="profile-bio">Bio: {{ user.bio if user.bio else 'Tidak ada bio.' }}</p>
            </div>

            {% if current_user.is_authenticated and current_user.id != user.id %}
                <div class="profile-actions">
                    {% if is_following %}
                        <a href="{{ url_for('unfollow_user', username=user.username) }}" class="btn btn-danger">Berhenti Mengikuti</a>
                    {% else %}
                        <a href="{{ url_for('follow_user', username=user.username) }}" class="btn btn-primary">Ikuti</a>
                    {% endif %}
                </div>
            {% endif %}

            <div class="profile-stats">
		<div class=" form-card">
                <ul>
                   <strong>Pengikut:</strong> {{ follower_count }} | <strong>Mengikuti:</strong> {{ following_count }}
                </ul>
		<ul>
                <li>Total Unggahan: {{ images|length }}</li>
                <li>Total Suka Diterima: {{ total_likes }}</li>
                <li>Total Komentar Diterima: {{ total_comments }}</li>
		</ul>
            </div>
        </div>
            <h2 class="gallery-title">Galeri: {{ user.username }}</h2>
        <div class="gallery">
            {% if images %}
                {% for image in images %}

                    <div class="card gallery-item">
                        <img src="{{ image.secure_url }}" data-src="{{ image.secure_url }}" calt="{{ image.description }}">
                        <p class="image-description">{{ image.description }}</p>

                <div class="like-section">
                    <button type="button" class="like-button btn" data-image-id="{{ image.id }}">
                        <svg class="heart-icon" 
                             data-liked="{% if current_user.is_authenticated and current_user.has_liked_image(image) %}true{% else %}false{% endif %}"
                             xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" 
                             >
                            <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path>
                        </svg>
                        <span class="like-count" data-image-id="{{ image.id }}">{{ image.likes|length }}</span>
                    </button>
                </div>
                    <div class="comments">
                        <h4>Komentar ({{ image.comments|length }})</h4>
                        <div class="comments-list">
                        {% for comment in image.comments %}
                            <p class="comment-item">
                                <strong><a href="{{ url_for('user_profile', username=comment.commenter.username) }}">{{ comment.commenter.username }}</a></strong>: {{ comment.content }}
                                {% if current_user.is_authenticated and (current_user.is_admin or current_user.id == comment.commenter.id) %}
                                    <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="post" class="delete-comment-form">
                                        <button type="submit" class="btn btn-danger btn-small">Hapus</button>
                                    </form>
                                {% endif %}
                            </p>
                        {% endfor %}
                        </div>
                        <form method="post" action="{{ url_for('comment_image', image_id=image.id) }}" id="comment-form" class="comment-form">
                            <textarea name="content" placeholder="Tambahkan komentar..." required></textarea>
                            <button type="submit" class="btn btn-primary">Kirim Komentar</button>
                        </form>
                    </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>Pengguna ini belum mengunggah gambar.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/ajax.js') }}"></script>
{% endblock %}
