{% extends "base.html" %}

{% block title %}Ruang Admin{% endblock %}

{% block content %}
    <div class="container">
        <div class="card">
            <h1 class="card-title">Ruang Admin</h1>
            <div class="message-area">
                {% for message in messages %}
                    <div class="message-item">
                        <p><strong>Dari: {{ message.sender.username }}</strong> <small>{{ message.date_posted.strftime('%Y-%m-%d %H:%M') }}</small></p>
                        <p>{{ message.content }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="card form-card">
            <h2 class="card-subtitle">Broadcast</h2>
            <form method="post">
                <div class="form-group">
                    <label for="message_content">Isi Pesan:</label>
                    <textarea id="message_content" name="content" placeholder="Pesan Ke Semua.! Anjing.." required></textarea>
                </div>
                <button type="submit" name="send_broadcast_message" class="btn btn-primary">Siarkan Pesan</button>
            </form>
        </div>

        <hr>
            
        <div class="card">
            <h2 class="card-subtitle">Pengaturan Cuaca</h2>
            <form method="post">
                <div class="form-group">
                    <label for="api_key">API Key (OpenWeatherMap):</label>
                    <input type="text" id="api_key" name="api_key" value="{{ current_weather_setting.api_key if current_weather_setting else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="city_name">Kota:</label>
                    <input type="text" id="city_name" name="city_name" value="{{ current_weather_setting.city_name if current_weather_setting else '' }}" required>
                </div>
                <button type="submit" name="update_weather" class="btn btn-primary">Simpan Cuaca</button>
            </form>

            {% if weather_preview %}
            <div class="weather-preview-admin mt-3"> {# mt-3 for some margin-top #}
                <h3>Pratinjau Cuaca Saat Ini:</h3>
                <p>Suhu: <strong>{{ weather_preview.temperature }}Â°C</strong></p>
                <p>Kondisi: <strong>{{ weather_preview.condition }}</strong></p>
                <p>Lokasi: <strong>{{ weather_preview.location }}</strong></p>
            </div>
            {% else %}
            <p class="text-muted mt-3">Belum ada pratinjau cuaca. Pastikan API Key dan Nama Kota sudah diisi dan disimpan.</p>
            {% endif %}

        </div>

        <hr>

        <div class="card">
            <h2 class="card-subtitle">Quote</h2>
            <form method="post">
                <div class="form-group">
                    <label for="quote_content">quote:</label>
                    <textarea id="quote_content" name="quote_content" rows="4" cols="50" required>{{ current_quote.content if current_quote else '' }}</textarea>
               </div>
                 <div class="form-group">
                            <label for="author">Penulis:</label>
                    <input type="text" id="author" name="author" value="{{ current_quote.author if current_quote else '' }}">
                </div>
                <button type="submit" name="update_quote" class="btn btn-primary">Simpan Kutipan</button>
            </form>
        </div>
    </div>
 {% endblock %}
